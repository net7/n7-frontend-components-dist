//---------------------------
// CAROUSEL.ts
//---------------------------
import { __decorate, __metadata } from "tslib";
import { Component, Input } from '@angular/core';
let CarouselComponent = class CarouselComponent {
    constructor() {
        this.loaded = false;
        /**
         * API of the carousel component
         */
        this.api = {
            /**
             * Used to lazy-load video resources.
             * Call api.load.videos on DOMContentReady event
             */
            load: {
                /** Changes all data-src attributes to src and calls <video>.load() */
                videos: () => {
                    const sources = Array.from(// gets all <source.lazy> tags
                    document.getElementById(this.data.containerId)
                        .getElementsByClassName('lazy'));
                    sources.forEach((source) => {
                        const url = source.getAttribute('data-src'); // gets the video url
                        source.classList.remove('lazy'); // removes the lazy class
                        source.setAttribute('src', url); // sets the url to src attribute
                        source.removeAttribute('data-src'); // removes the data-src attribute
                        source.parentElement.load(); // loads the video
                    });
                }
            }
        };
    }
    ngAfterContentChecked() {
        if (!this.data || this.loaded)
            return;
        this.loaded = true;
        setTimeout(() => {
            const { containerId, libOptions } = this.data;
            import('latte-carousel').then((module) => {
                const { Carousel } = module;
                const chart = new Carousel(`#${containerId}`, libOptions);
                // eslint-disable-next-line no-param-reassign, @typescript-eslint/no-unused-vars
                if (this.data.setInstance)
                    this.data.setInstance((d) => { d = chart; });
                // eslint-disable-next-line no-param-reassign, @typescript-eslint/no-unused-vars
                if (this.data.setComponentAPI)
                    this.data.setComponentAPI((d) => { d = this.api; });
                this.addButtonEvents(this.data);
            });
        });
    }
    onClick(payload) {
        if (!this.emit)
            return;
        this.emit('click', payload);
    }
    /**
     * Function that adds the event listeners to each button.
     * This is needed because when "new Carousel()" is called the event listeners are lost.
     */
    addButtonEvents({ slides, containerId }) {
        // Build array of button-id's & payloads.
        const buttons = slides
            .map((slide, slideID) => ({
            // id = container id - index of the slide
            id: `${containerId}-${slideID}`,
            payload: (((slide.action || {}).anchor || {}).payload) || undefined
        }))
            .filter((btn) => btn.payload);
        // find each button's anchor-wrapper and attach the event to it.
        buttons.forEach((btn) => {
            document.querySelector(`#${btn.id}`).parentElement.addEventListener('click', () => this.onClick(btn.payload));
        });
    }
};
__decorate([
    Input(),
    __metadata("design:type", Object)
], CarouselComponent.prototype, "data", void 0);
__decorate([
    Input(),
    __metadata("design:type", Object)
], CarouselComponent.prototype, "emit", void 0);
CarouselComponent = __decorate([
    Component({
        selector: 'n7-carousel',
        template: "<button *ngIf=\"data.classes === 'demo'\"\r\n        class=\"n7-btn\"\r\n        (click)=\"api.load.videos()\">api.load.videos()</button>\r\n\r\n<div *ngIf=\"data\"\r\n     class=\"n7-carousel {{ data.classes || '' }}\">\r\n  <!-- Warning: Do not style div.latte-carousel -->\r\n  <div id=\"{{data.containerId}}\"\r\n       class=\"latte-carousel\">\r\n    <ng-container *ngFor=\"let slide of data.slides; let index = index;\">\r\n      <ng-container *ngTemplateOutlet=\"carouselSlide; context:{slide: slide, index: index}\"></ng-container>\r\n    </ng-container>\r\n  </div>\r\n</div>\r\n\r\n<!-- ===== SLIDE WRAPPER ===== -->\r\n<ng-template #carouselSlide\r\n             let-slide=\"slide\"\r\n             let-slideID=\"index\">\r\n  <!-- Warning: Do not style div.latte-item -->\r\n  <div class=\"latte-item\">\r\n    <div class=\"n7-carousel__slide {{ slide.classes || ''}}\"\r\n         [ngClass]=\"{ 'has-image' : slide.background.image, 'has-video': slide.background.video }\"\r\n         [style.background-color]=\"slide.background.color ? slide.background.color : ''\"\r\n         [style.background-image]=\"slide.background.image ? 'url('+slide.background.image+')' : ''\">\r\n      <div class=\"n7-carousel__slide-content-wrapper\">\r\n        <div class=\"n7-carousel__slide-content\">\r\n          <div class=\"n7-carousel__slide-content-left\">\r\n            <ng-container *ngTemplateOutlet=\"slideForeground; context:{items: slide.items, slideID: slideID}\">\r\n            </ng-container>\r\n          </div>\r\n          <div class=\"n7-carousel__slide-content-right\"\r\n               *ngIf=\"slide.action\">\r\n            <n7-anchor-wrapper [data]=\"slide.action.anchor\"\r\n                               (clicked)=\"onClick($event)\">\r\n              <!-- Button ID's are used to dynamically reattach events after loading the carousel -->\r\n              <button id=\"{{data.containerId}}-{{slideID}}\"\r\n                      class=\"n7-hero__btn n7-btn n7-btn-cta n7-btn-l\">\r\n                {{slide.action.text}}\r\n              </button>\r\n            </n7-anchor-wrapper>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      <ng-container *ngIf=\"slide.background\">\r\n        <ng-container *ngTemplateOutlet=\"slideBackground; context:{$implicit: slide.background}\">\r\n        </ng-container>\r\n      </ng-container>\r\n    </div>\r\n  </div>\r\n</ng-template>\r\n\r\n<!-- ===== SLIDE FOREGROUND ===== -->\r\n<ng-template #slideForeground\r\n             let-items=\"items\"\r\n             let-slideID=\"slideID\">\r\n  <ng-container *ngFor=\"let el of items; let itemID = index\">\r\n    <h1 class=\"n7-carousel__slide-title\"\r\n        *ngIf=\"el.title\">{{el.title}}</h1>\r\n    <span class=\"n7-carousel__slide-text\"\r\n          *ngIf=\"el.text\">{{el.text}}</span>\r\n    <div class=\"n7-carousel__slide-metadata-wrapper\"\r\n         *ngIf=\"el.metadata\">\r\n      <ng-container *ngFor=\"let m of el.metadata\">\r\n        <div class=\"n7-carousel__slide-metadata\">\r\n            <span class=\"n7-carousel__slide-metadata-label\"\r\n              *ngIf=\"m.key\">{{m.key}}</span>\r\n            <span class=\"n7-carousel__slide-metadata-value\"\r\n              *ngIf=\"m.value\">{{m.value}}</span>\r\n        </div>\r\n      </ng-container>\r\n    </div>\r\n  </ng-container>\r\n</ng-template>\r\n\r\n<!-- ===== VIDEO BACKGROUND ===== -->\r\n<ng-template #slideBackground\r\n             let-bg>\r\n  <ng-container *ngIf=\"bg.video as v\">\r\n    <video #video\r\n           class=\"n7-carousel__slide-video\"\r\n           [poster]=\"v.poster\"\r\n           [height]=\"v.height\"\r\n           [width]=\"v.width\"\r\n           loop\r\n           muted\r\n           autoplay\r\n           playsinline>\r\n      <source #source\r\n              class=\"lazy\"\r\n              [attr.data-src]=\"v.url\"\r\n              type=\"video/mp4\">\r\n    </video>\r\n    <div class=\"n7-carousel__slide-video-overlay\">\r\n\r\n    </div>\r\n  </ng-container>\r\n</ng-template>\r\n"
    })
], CarouselComponent);
export { CarouselComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2Fyb3VzZWwuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AbjctZnJvbnRlbmQvY29tcG9uZW50cy8iLCJzb3VyY2VzIjpbImxpYi9jb21wb25lbnRzL2Nhcm91c2VsL2Nhcm91c2VsLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLDZCQUE2QjtBQUM3QixjQUFjO0FBQ2QsNkJBQTZCOztBQUU3QixPQUFPLEVBQ0wsU0FBUyxFQUFFLEtBQUssRUFDakIsTUFBTSxlQUFlLENBQUM7QUFpSnZCLElBQWEsaUJBQWlCLEdBQTlCLE1BQWEsaUJBQWlCO0lBQTlCO1FBS1UsV0FBTSxHQUFHLEtBQUssQ0FBQztRQUV2Qjs7V0FFRztRQUNILFFBQUcsR0FBRztZQUNKOzs7ZUFHRztZQUNILElBQUksRUFBRTtnQkFDSixzRUFBc0U7Z0JBQ3RFLE1BQU0sRUFBRSxHQUFHLEVBQUU7b0JBQ1gsTUFBTSxPQUFPLEdBQUcsS0FBSyxDQUFDLElBQUksQ0FBRSw4QkFBOEI7b0JBQ3hELFFBQVEsQ0FBQyxjQUFjLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUM7eUJBQzNDLHNCQUFzQixDQUFDLE1BQU0sQ0FBQyxDQUNsQyxDQUFDO29CQUNGLE9BQU8sQ0FBQyxPQUFPLENBQUMsQ0FBQyxNQUFtQixFQUFFLEVBQUU7d0JBQ3RDLE1BQU0sR0FBRyxHQUFHLE1BQU0sQ0FBQyxZQUFZLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxxQkFBcUI7d0JBQ2xFLE1BQU0sQ0FBQyxTQUFTLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMseUJBQXlCO3dCQUMxRCxNQUFNLENBQUMsWUFBWSxDQUFDLEtBQUssRUFBRSxHQUFHLENBQUMsQ0FBQyxDQUFDLGdDQUFnQzt3QkFDakUsTUFBTSxDQUFDLGVBQWUsQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLGlDQUFpQzt3QkFDcEUsTUFBTSxDQUFDLGFBQWtDLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQyxrQkFBa0I7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bnQiOlsiLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cclxuLy8gQ0FST1VTRUwudHNcclxuLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cclxuXHJcbmltcG9ydCB7XHJcbiAgQ29tcG9uZW50LCBJbnB1dCwgQWZ0ZXJDb250ZW50Q2hlY2tlZFxyXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBBbmNob3IgfSBmcm9tICcuLi8uLi9zaGFyZWQtaW50ZXJmYWNlcyc7XHJcblxyXG4vKipcclxuICogSW50ZXJmYWNlIGZvciBQYWdpbmF0aW9uQ29tcG9uZW50J3MgbGlua3MgKHBhZ2VzIGFuZCBuYXZpZ2F0aW9uIGJ1dHRvbnMpXHJcbiAqXHJcbiAqIEBwcm9wZXJ0eSB0ZXh0IChyZXF1aXJlZClcclxuICogQHByb3BlcnR5IGFuY2hvciAob3B0aW9uYWwpXHJcbiAqIEBwcm9wZXJ0eSBjbGFzc2VzIChvcHRpb25hbClcclxuICogQHByb3BlcnR5IF9tZXRhIChvcHRpb25hbClcclxuICovXHJcbmV4cG9ydCBpbnRlcmZhY2UgQ2Fyb3VzZWxCdXR0b24ge1xyXG4gIC8qKlxyXG4gICAqIGlubmVySFRNTCBvciBwbGFpbiB0ZXh0IGZvciB0aGUgbGFiZWxcclxuICAgKi9cclxuICB0ZXh0Pzogc3RyaW5nO1xyXG4gIC8qKlxyXG4gICAqIGFkZGl0aW9uYWwgaHRtbCBjbGFzc2VzXHJcbiAgICovXHJcbiAgY2xhc3Nlcz86IHN0cmluZztcclxuICBhbmNob3I/OiBBbmNob3I7XHJcbiAgLyoqXHJcbiAgICogYWRkaXRpb25hbCBpbmZvXHJcbiAgICovXHJcbiAgX21ldGE/OiBhbnk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBJbnRlcmZhY2UgZm9yIFBhZ2luYXRpb25Db21wb25lbnQncyBNZXRhZGF0YSB0dXBsZXMgKHBhZ2VzIGFuZCBuYXZpZ2F0aW9uIGJ1dHRvbnMpXHJcbiAqXHJcbiAqIEBwcm9wZXJ0eSBrZXkgKG9wdGlvbmFsKVxyXG4gKiBAcHJvcGVydHkgdmFsdWUgKG9wdGlvbmFsKVxyXG4gKi9cclxuZXhwb3J0IGludGVyZmFjZSBDYXJvdXNlbE1ldGFkYXRhIHtcclxuICAvKipcclxuICAgKiBGaXJzdCBlbGVtZW50XHJcbiAgICovXHJcbiAga2V5Pzogc3RyaW5nO1xyXG4gIC8qKlxyXG4gICAqIFNlY29uZCBlbGVtZW50XHJcbiAgICovXHJcbiAgdmFsdWU/OiBzdHJpbmc7XHJcbn1cclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgQ2Fyb3VzZWxCYWNrZ3JvdW5kSXRlbSB7XHJcbiAgLyoqXHJcbiAgICogQmFja2dyb3VuZCBpbWFnZSBmb3IgdGhlIGNhcm91c2VsXHJcbiAgICovXHJcbiAgaW1hZ2U/OiBzdHJpbmc7XHJcbiAgLyoqXHJcbiAgICogQmFja2dyb3VuZCB2aWRlbyBmb3IgdGhlIGNhcm91c2VsXHJcbiAgICovXHJcbiAgdmlkZW8/OiB7XHJcbiAgICAvKiogTWVkaWEgVVJMICovXHJcbiAgICB1cmw6IHN0cmluZztcclxuICAgIC8qKiBQbGFjZWhvbGRlciBpbWFnZSB3aGlsZSBsb2FkaW5nICovXHJcbiAgICBwb3N0ZXI/OiBzdHJpbmc7XHJcbiAgICAvKiogVmlkZW8gd2lkdGggaW4gcGl4ZWxzICovXHJcbiAgICB3aWR0aDogbnVtYmVyO1xyXG4gICAgLyoqIFZpZGVvIGhlaWdodCBpbiBwaXhlbHMgKi9cclxuICAgIGhlaWdodDogbnVtYmVyO1xyXG4gIH07XHJcbiAgLyoqXHJcbiAgICogQmFja2dyb3VuZCBjb2xvciBmb3IgdGhlIGNhcm91c2VsXHJcbiAgICovXHJcbiAgY29sb3I/OiBzdHJpbmc7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBJbnRlcmZhY2UgZm9yIENhcm91c2VsQ29tcG9uZW50J3MgXCJJdGVtXCJcclxuICpcclxuICogQHByb3BlcnR5IHRpdGxlIChvcHRpb25hbClcclxuICogQHByb3BlcnR5IHRleHQgKG9wdGlvbmFsKVxyXG4gKiBAcHJvcGVydHkgbWV0YWRhdGEgKG9wdGlvbmFsKVxyXG4gKiBAcHJvcGVydHkgYWN0aW9uIChvcHRpb25hbClcclxuICogQHByb3BlcnR5IGNsYXNzZXMgKG9wdGlvbmFsKVxyXG4gKiBAcHJvcGVydHkgX21ldGEgKG9wdGlvbmFsKVxyXG4gKi9cclxuZXhwb3J0IGludGVyZmFjZSBDYXJvdXNlbEZvcmVncm91bmRJdGVtIHtcclxuICAvKipcclxuICAgKiBIZWFkZXJcclxuICAgKi9cclxuICB0aXRsZT86IHN0cmluZztcclxuICAvKipcclxuICAgKiBUZXh0IHBhcmFncmFwaCAvIHN1YnRpdGxlIC8gcHJldGl0bGVcclxuICAgKi9cclxuICB0ZXh0Pzogc3RyaW5nO1xyXG4gIC8qKlxyXG4gICAqIE1ldGFkYXRhXHJcbiAgICovXHJcbiAgbWV0YWRhdGE/OiBDYXJvdXNlbE1ldGFkYXRhW107XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBJbnRlcmZhY2UgZm9yIENhcm91c2VsQ29tcG9uZW50J3MgXCJkYXRhXCJcclxuICpcclxuICogQHByb3BlcnR5IGl0ZW1zIChyZXF1aXJlZClcclxuICogQHByb3BlcnR5IGltYWdlIChvcHRpb25hbClcclxuICogQHByb3BlcnR5IHZpZGVvIChvcHRpb25hbClcclxuICogQHByb3BlcnR5IGNsYXNzZXMgKG9wdGlvbmFsKVxyXG4gKiBAcHJvcGVydHkgX21ldGEgKG9wdGlvbmFsKVxyXG4gKi9cclxuZXhwb3J0IGludGVyZmFjZSBDYXJvdXNlbERhdGEge1xyXG4gIC8qKlxyXG4gICAqIElEIE9mIHRoZSBjYXJvdXNlbCBjb250YWluZXJcclxuICAgKi9cclxuICBjb250YWluZXJJZDogc3RyaW5nO1xyXG4gIC8qKlxyXG4gICAqIE9wdGlvbnMgZm9yIHRoZSBjYXJvdXNlbCBsaWJyYXJ5ICggZG9jcyBoZXJlIDogaHR0cHM6Ly9sYXR0ZWNhcm91c2VsLmRldi8gKVxyXG4gICAqL1xyXG4gIGxpYk9wdGlvbnM/OiBhbnk7XHJcbiAgLyoqXHJcbiAgICogQXJyYXkgb2YgY2Fyb3VzZWwgc2xpZGVzXHJcbiAgICovXHJcbiAgc2xpZGVzOiB7XHJcbiAgICBpdGVtczogQ2Fyb3VzZWxGb3JlZ3JvdW5kSXRlbVtdO1xyXG4gICAgLyoqXHJcbiAgICAgKiBCdXR0b25cclxuICAgICAqL1xyXG4gICAgYWN0aW9uPzogQ2Fyb3VzZWxCdXR0b247XHJcbiAgICBiYWNrZ3JvdW5kPzogQ2Fyb3VzZWxCYWNrZ3JvdW5kSXRlbTtcclxuICAgIGNsYXNzZXM/OiBzdHJpbmc7XHJcbiAgfVtdO1xyXG4gIC8qKlxyXG4gICAqIENhbGxiYWNrIGZvciBnZXR0aW5nIHRoZSBjYXJvdXNlbCBpbnN0YW5jZVxyXG4gICAqL1xyXG4gIHNldEluc3RhbmNlPzogYW55O1xyXG4gIC8qKlxyXG4gICAqIENhbGxiYWNrIHRvIGFjY2VzcyB0aGUgY2Fyb3VzZWwgQVBJXHJcbiAgICogKi9cclxuICBzZXRDb21wb25lbnRBUEk/OiBhbnk7XHJcbiAgLyoqXHJcbiAgICogQ2xhc3NlcyBmb3IgdGhlIGNhcm91c2VsIGNvbXBvbmVudFxyXG4gICAqL1xyXG4gIGNsYXNzZXM/OiBzdHJpbmc7XHJcbiAgLyoqXHJcbiAgICogQWRkaXRpb25hbCBkYXRhIHVzZWZ1bCBmb3IgdGhlIGNvbXBvbmVudCdzIGxvZ2ljXHJcbiAgICovXHJcbiAgX21ldGE/OiBhbnk7XHJcbn1cclxuXHJcbkBDb21wb25lbnQoe1xyXG4gIHNlbGVjdG9yOiAnbjctY2Fyb3VzZWwnLFxyXG4gIHRlbXBsYXRlVXJsOiAnLi9jYXJvdXNlbC5odG1sJ1xyXG59KVxyXG5leHBvcnQgY2xhc3MgQ2Fyb3VzZWxDb21wb25lbnQgaW1wbGVtZW50cyBBZnRlckNvbnRlbnRDaGVja2VkIHtcclxuICBASW5wdXQoKSBkYXRhOiBDYXJvdXNlbERhdGE7XHJcblxyXG4gIEBJbnB1dCgpIGVtaXQ6IGFueTtcclxuXHJcbiAgcHJpdmF0ZSBsb2FkZWQgPSBmYWxzZTtcclxuXHJcbiAgLyoqXHJcbiAgICogQVBJIG9mIHRoZSBjYXJvdXNlbCBjb21wb25lbnRcclxuICAgKi9cclxuICBhcGkgPSB7XHJcbiAgICAvKipcclxuICAgICAqIFVzZWQgdG8gbGF6eS1sb2FkIHZpZGVvIHJlc291cmNlcy5cclxuICAgICAqIENhbGwgYXBpLmxvYWQudmlkZW9zIG9uIERPTUNvbnRlbnRSZWFkeSBldmVudFxyXG4gICAgICovXHJcbiAgICBsb2FkOiB7XHJcbiAgICAgIC8qKiBDaGFuZ2VzIGFsbCBkYXRhLXNyYyBhdHRyaWJ1dGVzIHRvIHNyYyBhbmQgY2FsbHMgPHZpZGVvPi5sb2FkKCkgKi9cclxuICAgICAgdmlkZW9zOiAoKSA9PiB7XHJcbiAgICAgICAgY29uc3Qgc291cmNlcyA9IEFycmF5LmZyb20oIC8vIGdldHMgYWxsIDxzb3VyY2UubGF6eT4gdGFnc1xyXG4gICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQodGhpcy5kYXRhLmNvbnRhaW5lcklkKVxyXG4gICAgICAgICAgICAuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgnbGF6eScpXHJcbiAgICAgICAgKTtcclxuICAgICAgICBzb3VyY2VzLmZvckVhY2goKHNvdXJjZTogSFRNTEVsZW1lbnQpID0+IHtcclxuICAgICAgICAgIGNvbnN0IHVybCA9IHNvdXJjZS5nZXRBdHRyaWJ1dGUoJ2RhdGEtc3JjJyk7IC8vIGdldHMgdGhlIHZpZGVvIHVybFxyXG4gICAgICAgICAgc291cmNlLmNsYXNzTGlzdC5yZW1vdmUoJ2xhenknKTsgLy8gcmVtb3ZlcyB0aGUgbGF6eSBjbGFzc1xyXG4gICAgICAgICAgc291cmNlLnNldEF0dHJpYnV0ZSgnc3JjJywgdXJsKTsgLy8gc2V0cyB0aGUgdXJsIHRvIHNyYyBhdHRyaWJ1dGVcclxuICAgICAgICAgIHNvdXJjZS5yZW1vdmVBdHRyaWJ1dGUoJ2RhdGEtc3JjJyk7IC8vIHJlbW92ZXMgdGhlIGRhdGEtc3JjIGF0dHJpYnV0ZVxyXG4gICAgICAgICAgKHNvdXJjZS5wYXJlbnRFbGVtZW50IGFzIEhUTUxWaWRlb0VsZW1lbnQpLmxvYWQoKTsgLy8gbG9hZHMgdGhlIHZpZGVvXHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9O1xyXG5cclxuICBuZ0FmdGVyQ29udGVudENoZWNrZWQoKTogdm9pZCB7XHJcbiAgICBpZiAoIXRoaXMuZGF0YSB8fCB0aGlzLmxvYWRlZCkgcmV0dXJuO1xyXG4gICAgdGhpcy5sb2FkZWQgPSB0cnVlO1xyXG4gICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHsgY29udGFpbmVySWQsIGxpYk9wdGlvbnMgfSA9IHRoaXMuZGF0YTtcclxuICAgICAgaW1wb3J0KCdsYXR0ZS1jYXJvdXNlbCcpLnRoZW4oKG1vZHVsZSkgPT4ge1xyXG4gICAgICAgIGNvbnN0IHsgQ2Fyb3VzZWwgfSA9IG1vZHVsZTtcclxuICAgICAgICBjb25zdCBjaGFydCA9IG5ldyBDYXJvdXNlbChgIyR7Y29udGFpbmVySWR9YCwgbGliT3B0aW9ucyk7XHJcbiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXBhcmFtLXJlYXNzaWduLCBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tdW51c2VkLXZhcnNcclxuICAgICAgICBpZiAodGhpcy5kYXRhLnNldEluc3RhbmNlKSB0aGlzLmRhdGEuc2V0SW5zdGFuY2UoKGQpOiB2b2lkID0+IHsgZCA9IGNoYXJ0OyB9KTtcclxuICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tcGFyYW0tcmVhc3NpZ24sIEB0eXBlc2NyaXB0LWVzbGludC9uby11bnVzZWQtdmFyc1xyXG4gICAgICAgIGlmICh0aGlzLmRhdGEuc2V0Q29tcG9uZW50QVBJKSB0aGlzLmRhdGEuc2V0Q29tcG9uZW50QVBJKChkKTogdm9pZCA9PiB7IGQgPSB0aGlzLmFwaTsgfSk7XHJcbiAgICAgICAgdGhpcy5hZGRCdXR0b25FdmVudHModGhpcy5kYXRhKTtcclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIG9uQ2xpY2socGF5bG9hZCkge1xyXG4gICAgaWYgKCF0aGlzLmVtaXQpIHJldHVybjtcclxuICAgIHRoaXMuZW1pdCgnY2xpY2snLCBwYXlsb2FkKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEZ1bmN0aW9uIHRoYXQgYWRkcyB0aGUgZXZlbnQgbGlzdGVuZXJzIHRvIGVhY2ggYnV0dG9uLlxyXG4gICAqIFRoaXMgaXMgbmVlZGVkIGJlY2F1c2Ugd2hlbiBcIm5ldyBDYXJvdXNlbCgpXCIgaXMgY2FsbGVkIHRoZSBldmVudCBsaXN0ZW5lcnMgYXJlIGxvc3QuXHJcbiAgICovXHJcbiAgYWRkQnV0dG9uRXZlbnRzKHsgc2xpZGVzLCBjb250YWluZXJJZCB9KSB7XHJcbiAgICAvLyBCdWlsZCBhcnJheSBvZiBidXR0b24taWQncyAmIHBheWxvYWRzLlxyXG4gICAgY29uc3QgYnV0dG9uczogeyBpZDogc3RyaW5nOyBwYXlsb2FkOiBhbnkgfVtdID0gc2xpZGVzXHJcbiAgICAgIC5tYXAoKHNsaWRlLCBzbGlkZUlEKSA9PiAoe1xyXG4gICAgICAgIC8vIGlkID0gY29udGFpbmVyIGlkIC0gaW5kZXggb2YgdGhlIHNsaWRlXHJcbiAgICAgICAgaWQ6IGAke2NvbnRhaW5lcklkfS0ke3NsaWRlSUR9YCxcclxuICAgICAgICBwYXlsb2FkOiAoKChzbGlkZS5hY3Rpb24gfHwge30pLmFuY2hvciB8fCB7fSkucGF5bG9hZCkgfHwgdW5kZWZpbmVkXHJcbiAgICAgIH0pKVxyXG4gICAgICAuZmlsdGVyKChidG4pID0+IGJ0bi5wYXlsb2FkKTtcclxuICAgIC8vIGZpbmQgZWFjaCBidXR0b24ncyBhbmNob3Itd3JhcHBlciBhbmQgYXR0YWNoIHRoZSBldmVudCB0byBpdC5cclxuICAgIGJ1dHRvbnMuZm9yRWFjaCgoYnRuKSA9PiB7XHJcbiAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYCMke2J0bi5pZH1gKS5wYXJlbnRFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXHJcbiAgICAgICAgJ2NsaWNrJyxcclxuICAgICAgICAoKSA9PiB0aGlzLm9uQ2xpY2soYnRuLnBheWxvYWQpXHJcbiAgICAgICk7XHJcbiAgICB9KTtcclxuICB9XHJcbn1cclxuIl19