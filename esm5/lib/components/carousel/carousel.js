//---------------------------
// CAROUSEL.ts
//---------------------------
import { __decorate, __metadata } from "tslib";
import { Component, Input } from '@angular/core';
var CarouselComponent = /** @class */ (function () {
    function CarouselComponent() {
        var _this = this;
        this.loaded = false;
        /**
         * API of the carousel component
         */
        this.api = {
            /**
             * Used to lazy-load video resources.
             * Call api.load.videos on DOMContentReady event
             */
            load: {
                /** Changes all data-src attributes to src and calls <video>.load() */
                videos: function () {
                    var sources = Array.from(// gets all <source.lazy> tags
                    document.getElementById(_this.data.containerId)
                        .getElementsByClassName('lazy'));
                    sources.forEach(function (source) {
                        var url = source.getAttribute('data-src'); // gets the video url
                        source.classList.remove('lazy'); // removes the lazy class
                        source.setAttribute('src', url); // sets the url to src attribute
                        source.removeAttribute('data-src'); // removes the data-src attribute
                        source.parentElement.load(); // loads the video
                    });
                }
            }
        };
    }
    CarouselComponent.prototype.ngAfterContentChecked = function () {
        var _this = this;
        if (!this.data || this.loaded)
            return;
        this.loaded = true;
        setTimeout(function () {
            var _a = _this.data, containerId = _a.containerId, libOptions = _a.libOptions;
            import('latte-carousel').then(function (module) {
                var Carousel = module.Carousel;
                var chart = new Carousel("#" + containerId, libOptions);
                // eslint-disable-next-line no-param-reassign, @typescript-eslint/no-unused-vars
                if (_this.data.setInstance)
                    _this.data.setInstance(function (d) { d = chart; });
                // eslint-disable-next-line no-param-reassign, @typescript-eslint/no-unused-vars
                if (_this.data.setComponentAPI)
                    _this.data.setComponentAPI(function (d) { d = _this.api; });
                _this.addButtonEvents(_this.data);
            });
        });
    };
    CarouselComponent.prototype.onClick = function (payload) {
        if (!this.emit)
            return;
        this.emit('click', payload);
    };
    /**
     * Function that adds the event listeners to each button.
     * This is needed because when "new Carousel()" is called the event listeners are lost.
     */
    CarouselComponent.prototype.addButtonEvents = function (_a) {
        var _this = this;
        var slides = _a.slides, containerId = _a.containerId;
        // Build array of button-id's & payloads.
        var buttons = slides
            .map(function (slide, slideID) { return ({
            // id = container id - index of the slide
            id: containerId + "-" + slideID,
            payload: (((slide.action || {}).anchor || {}).payload) || undefined
        }); })
            .filter(function (btn) { return btn.payload; });
        // find each button's anchor-wrapper and attach the event to it.
        buttons.forEach(function (btn) {
            document.querySelector("#" + btn.id).parentElement.addEventListener('click', function () { return _this.onClick(btn.payload); });
        });
    };
    __decorate([
        Input(),
        __metadata("design:type", Object)
    ], CarouselComponent.prototype, "data", void 0);
    __decorate([
        Input(),
        __metadata("design:type", Object)
    ], CarouselComponent.prototype, "emit", void 0);
    CarouselComponent = __decorate([
        Component({
            selector: 'n7-carousel',
            template: "<button *ngIf=\"data && data.classes === 'demo'\"\n        class=\"n7-btn\"\n        (click)=\"api.load.videos()\">api.load.videos()</button>\n\n<div *ngIf=\"data\"\n     class=\"n7-carousel {{ data.classes || '' }}\">\n  <!-- Warning: Do not style div.latte-carousel -->\n  <div id=\"{{data.containerId}}\"\n       class=\"latte-carousel\">\n    <ng-container *ngFor=\"let slide of data.slides; let index = index;\">\n      <ng-container *ngTemplateOutlet=\"carouselSlide; context:{slide: slide, index: index}\"></ng-container>\n    </ng-container>\n  </div>\n</div>\n\n<!-- ===== SLIDE WRAPPER ===== -->\n<ng-template #carouselSlide\n             let-slide=\"slide\"\n             let-slideID=\"index\">\n  <!-- Warning: Do not style div.latte-item -->\n  <div class=\"latte-item\">\n    <div class=\"n7-carousel__slide {{ slide.classes || ''}}\"\n         [ngClass]=\"{ 'has-image' : slide.background.image, 'has-video': slide.background.video }\"\n         [style.background-color]=\"slide.background.color ? slide.background.color : ''\"\n         [style.background-image]=\"slide.background.image ? 'url('+slide.background.image+')' : ''\">\n      <div class=\"n7-carousel__slide-content-wrapper\">\n        <div class=\"n7-carousel__slide-content\">\n          <div class=\"n7-carousel__slide-content-left\">\n            <ng-container *ngTemplateOutlet=\"slideForeground; context:{items: slide.items, slideID: slideID}\">\n            </ng-container>\n          </div>\n          <div class=\"n7-carousel__slide-content-right\"\n               *ngIf=\"slide.action\">\n            <n7-anchor-wrapper [data]=\"slide.action.anchor\"\n                               (clicked)=\"onClick($event)\">\n              <!-- Button ID's are used to dynamically reattach events after loading the carousel -->\n              <button id=\"{{data.containerId}}-{{slideID}}\"\n                      class=\"n7-hero__btn n7-btn n7-btn-cta n7-btn-l\">\n                {{slide.action.text}}\n              </button>\n            </n7-anchor-wrapper>\n          </div>\n        </div>\n      </div>\n      <ng-container *ngIf=\"slide.background\">\n        <ng-container *ngTemplateOutlet=\"slideBackground; context:{$implicit: slide.background}\">\n        </ng-container>\n      </ng-container>\n    </div>\n  </div>\n</ng-template>\n\n<!-- ===== SLIDE FOREGROUND ===== -->\n<ng-template #slideForeground\n             let-items=\"items\"\n             let-slideID=\"slideID\">\n  <ng-container *ngFor=\"let el of items; let itemID = index\">\n    <h1 class=\"n7-carousel__slide-title\"\n        *ngIf=\"el.title\">{{el.title}}</h1>\n    <div class=\"n7-carousel__slide-text\"\n          *ngIf=\"el.text\" [innerHTML]=\"el.text\"></div>\n    <div class=\"n7-carousel__slide-metadata-wrapper\"\n         *ngIf=\"el.metadata\">\n      <ng-container *ngFor=\"let m of el.metadata\">\n        <div class=\"n7-carousel__slide-metadata\">\n            <span class=\"n7-carousel__slide-metadata-label\"\n              *ngIf=\"m.key\">{{m.key}}</span>\n            <span class=\"n7-carousel__slide-metadata-value\"\n              *ngIf=\"m.value\">{{m.value}}</span>\n        </div>\n      </ng-container>\n    </div>\n  </ng-container>\n</ng-template>\n\n<!-- ===== VIDEO BACKGROUND ===== -->\n<ng-template #slideBackground\n             let-bg>\n  <ng-container *ngIf=\"bg.video as v\">\n    <video #video\n           class=\"n7-carousel__slide-video\"\n           [poster]=\"v.poster\"\n           [height]=\"v.height\"\n           [width]=\"v.width\"\n           loop\n           muted\n           autoplay\n           playsinline>\n      <source #source\n              class=\"lazy\"\n              [attr.data-src]=\"v.url\"\n              type=\"video/mp4\">\n    </video>\n    <div class=\"n7-carousel__slide-video-overlay\">\n\n    </div>\n  </ng-container>\n</ng-template>\n"
        })
    ], CarouselComponent);
    return CarouselComponent;
}());
export { CarouselComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2Fyb3VzZWwuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AbjctZnJvbnRlbmQvY29tcG9uZW50cy8iLCJzb3VyY2VzIjpbImxpYi9jb21wb25lbnRzL2Nhcm91c2VsL2Nhcm91c2VsLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLDZCQUE2QjtBQUM3QixjQUFjO0FBQ2QsNkJBQTZCOztBQUU3QixPQUFPLEVBQ0wsU0FBUyxFQUFFLEtBQUssRUFDakIsTUFBTSxlQUFlLENBQUM7QUFpSnZCO0lBQUE7UUFBQSxpQkE0RUM7UUF2RVMsV0FBTSxHQUFHLEtBQUssQ0FBQztRQUV2Qjs7V0FFRztRQUNILFFBQUcsR0FBRztZQUNKOzs7ZUFHRztZQUNILElBQUksRUFBRTtnQkFDSixzRUFBc0U7Z0JBQ3RFLE1BQU0sRUFBRTtvQkFDTixJQUFNLE9BQU8sR0FBRyxLQUFLLENBQUMsSUFBSSxDQUFFLDhCQUE4QjtvQkFDeEQsUUFBUSxDQUFDLGNBQWMsQ0FBQyxLQUFJLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQzt5QkFDM0Msc0JBQXNCLENBQUMsTUFBTSxDQUFDLENBQ2xDLENBQUM7b0JBQ0YsT0FBTyxDQUFDLE9BQU8sQ0FBQyxVQUFDLE1BQW1CO3dCQUNsQyxJQUFNLEdBQUcsR0FBRyxNQUFNLENBQUMsWUFBWSxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUMscUJBQXFCO3dCQUNsRSxNQUFNLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLHlCQUF5Qjt3QkFDMUQsTUFBTSxDQUFDLFlBQVksQ0FBQyxLQUFLLEVBQUUsR0FBRyxDQUFDLENBQUMsQ0FBQyxnQ0FBZ0M7d0JBQ2pFLE1BQU0sQ0FBQyxlQUFlLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxpQ0FBaUM7d0JBQ3BFLE1BQU0sQ0FBQyxhQUFrQyxDQUFDLElBQUksRUFBRSxDQUFDLENBQUMsa0JBQWtCO29CQUN2RSxDQUFDLENBQUMsQ0FBQztnQkFDTCxDQUFDO2FBQ0Y7U0FDRixDQUFDO0lBNkNKLENBQUM7SUEzQ0MsaURBQXFCLEdBQXJCO1FBQUEsaUJBZUM7UUFkQyxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksSUFBSSxJQUFJLENBQUMsTUFBTTtZQUFFLE9BQU87UUFDdEMsSUFBSSxDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUM7UUFDbkIsVUFBVSxDQUFDO1lBQ0gsSUFBQSxlQUF1QyxFQUFyQyw0QkFBVyxFQUFFLDBCQUF3QixDQUFDO1lBQzlDLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDLElBQUksQ0FBQyxVQUFDLE1BQU07Z0JBQzNCLElBQUEsMEJBQVEsQ0FBWTtnQkFDNUIsSUFBTSxLQUFLLEdBQUcsSUFBSSxRQUFRLENBQUMsTUFBSSxXQUFhLEVBQUUsVUFBVSxDQUFDLENBQUM7Z0JBQzFELGdGQUFnRjtnQkFDaEYsSUFBSSxLQUFJLENBQUMsSUFBSSxDQUFDLFdBQVc7b0JBQUUsS0FBSSxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsVUFBQyxDQUFDLElBQWEsQ0FBQyxHQUFHLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO2dCQUM5RSxnRkFBZ0Y7Z0JBQ2hGLElBQUksS0FBSSxDQUFDLElBQUksQ0FBQyxlQUFlO29CQUFFLEtBQUksQ0FBQyxJQUFJLENBQUMsZUFBZSxDQUFDLFVBQUMsQ0FBQyxJQUFhLENBQUMsR0FBRyxLQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBQ3pGLEtBQUksQ0FBQyxlQUFlLENBQUMsS0FBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQ2xDLENBQUMsQ0FBQyxDQUFDO1FBQ0wsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDO0lBRUQsbUNBQU8sR0FBUCxVQUFRLE9BQU87UUFDYixJQUFJLENBQUMsSUFBSSxDQUFDLElBQUk7WUFBRSxPQUFPO1FBQ3ZCLElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUFFLE9BQU8sQ0FBQyxDQUFDO0lBQzlCLENBQUM7SUFFRDs7O09BR0c7SUFDSCwyQ0FBZSxHQUFmLFVBQWdCLEVBQXVCO1FBQXZDLGlCQWdCQztZQWhCaUIsa0JBQU0sRUFBRSw0QkFBVztRQUNuQyx5Q0FBeUM7UUFDekMsSUFBTSxPQUFPLEdBQW1DLE1BQU07YUFDbkQsR0FBRyxDQUFDLFVBQUMsS0FBSyxFQUFFLE9BQU8sSUFBSyxPQUFBLENBQUM7WUFDeEIseUNBQXlDO1lBQ3pDLEVBQUUsRUFBSyxXQUFXLFNBQUksT0FBUztZQUMvQixPQUFPLEVBQUUsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLE1BQU0sSUFBSSxFQUFFLENBQUMsQ0FBQyxNQUFNLElBQUksRUFBRSxDQUFDLENBQUMsT0FBTyxDQUFDLElBQUksU0FBUztTQUNwRSxDQUFDLEVBSnVCLENBSXZCLENBQUM7YUFDRixNQUFNLENBQUMsVUFBQyxHQUFHLElBQUssT0FBQSxHQUFHLENBQUMsT0FBTyxFQUFYLENBQVcsQ0FBQyxDQUFDO1FBQ2hDLGdFQUFnRTtRQUNoRSxPQUFPLENBQUMsT0FBTyxDQUFDLFVBQUMsR0FBRztZQUNsQixRQUFRLENBQUMsYUFBYSxDQUFDLE1BQUksR0FBRyxDQUFDLEVBQUksQ0FBQyxDQUFDLGFBQWEsQ0FBQyxnQkFBZ0IsQ0FDakUsT0FBTyxFQUNQLGNBQU0sT0FBQSxLQUFJLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsRUFBekIsQ0FBeUIsQ0FDaEMsQ0FBQztRQUNKLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQTFFUTtRQUFSLEtBQUssRUFBRTs7bURBQW9CO0lBRW5CO1FBQVIsS0FBSyxFQUFFOzttREFBVztJQUhSLGlCQUFpQjtRQUo3QixTQUFTLENBQUM7WUFDVCxRQUFRLEVBQUUsYUFBYTtZQUN2QixzeUhBQThCO1NBQy9CLENBQUM7T0FDVyxpQkFBaUIsQ0E0RTdCO0lBQUQsd0JBQUM7Q0FBQSxBQTVFRCxJQTRFQztTQTVFWSxpQkFBaUIiLCJzb3VyY2VzQ29udGVudCI6WyIvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuLy8gQ0FST1VTRUwudHNcbi8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cbmltcG9ydCB7XG4gIENvbXBvbmVudCwgSW5wdXQsIEFmdGVyQ29udGVudENoZWNrZWRcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBBbmNob3IgfSBmcm9tICcuLi8uLi9zaGFyZWQtaW50ZXJmYWNlcyc7XG5cbi8qKlxuICogSW50ZXJmYWNlIGZvciBQYWdpbmF0aW9uQ29tcG9uZW50J3MgbGlua3MgKHBhZ2VzIGFuZCBuYXZpZ2F0aW9uIGJ1dHRvbnMpXG4gKlxuICogQHByb3BlcnR5IHRleHQgKHJlcXVpcmVkKVxuICogQHByb3BlcnR5IGFuY2hvciAob3B0aW9uYWwpXG4gKiBAcHJvcGVydHkgY2xhc3NlcyAob3B0aW9uYWwpXG4gKiBAcHJvcGVydHkgX21ldGEgKG9wdGlvbmFsKVxuICovXG5leHBvcnQgaW50ZXJmYWNlIENhcm91c2VsQnV0dG9uIHtcbiAgLyoqXG4gICAqIGlubmVySFRNTCBvciBwbGFpbiB0ZXh0IGZvciB0aGUgbGFiZWxcbiAgICovXG4gIHRleHQ/OiBzdHJpbmc7XG4gIC8qKlxuICAgKiBhZGRpdGlvbmFsIGh0bWwgY2xhc3Nlc1xuICAgKi9cbiAgY2xhc3Nlcz86IHN0cmluZztcbiAgYW5jaG9yPzogQW5jaG9yO1xuICAvKipcbiAgICogYWRkaXRpb25hbCBpbmZvXG4gICAqL1xuICBfbWV0YT86IGFueTtcbn1cblxuLyoqXG4gKiBJbnRlcmZhY2UgZm9yIFBhZ2luYXRpb25Db21wb25lbnQncyBNZXRhZGF0YSB0dXBsZXMgKHBhZ2VzIGFuZCBuYXZpZ2F0aW9uIGJ1dHRvbnMpXG4gKlxuICogQHByb3BlcnR5IGtleSAob3B0aW9uYWwpXG4gKiBAcHJvcGVydHkgdmFsdWUgKG9wdGlvbmFsKVxuICovXG5leHBvcnQgaW50ZXJmYWNlIENhcm91c2VsTWV0YWRhdGEge1xuICAvKipcbiAgICogRmlyc3QgZWxlbWVudFxuICAgKi9cbiAga2V5Pzogc3RyaW5nO1xuICAvKipcbiAgICogU2Vjb25kIGVsZW1lbnRcbiAgICovXG4gIHZhbHVlPzogc3RyaW5nO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIENhcm91c2VsQmFja2dyb3VuZEl0ZW0ge1xuICAvKipcbiAgICogQmFja2dyb3VuZCBpbWFnZSBmb3IgdGhlIGNhcm91c2VsXG4gICAqL1xuICBpbWFnZT86IHN0cmluZztcbiAgLyoqXG4gICAqIEJhY2tncm91bmQgdmlkZW8gZm9yIHRoZSBjYXJvdXNlbFxuICAgKi9cbiAgdmlkZW8/OiB7XG4gICAgLyoqIE1lZGlhIFVSTCAqL1xuICAgIHVybDogc3RyaW5nO1xuICAgIC8qKiBQbGFjZWhvbGRlciBpbWFnZSB3aGlsZSBsb2FkaW5nICovXG4gICAgcG9zdGVyPzogc3RyaW5nO1xuICAgIC8qKiBWaWRlbyB3aWR0aCBpbiBwaXhlbHMgKi9cbiAgICB3aWR0aDogbnVtYmVyO1xuICAgIC8qKiBWaWRlbyBoZWlnaHQgaW4gcGl4ZWxzICovXG4gICAgaGVpZ2h0OiBudW1iZXI7XG4gIH07XG4gIC8qKlxuICAgKiBCYWNrZ3JvdW5kIGNvbG9yIGZvciB0aGUgY2Fyb3VzZWxcbiAgICovXG4gIGNvbG9yPzogc3RyaW5nO1xufVxuXG4vKipcbiAqIEludGVyZmFjZSBmb3IgQ2Fyb3VzZWxDb21wb25lbnQncyBcIkl0ZW1cIlxuICpcbiAqIEBwcm9wZXJ0eSB0aXRsZSAob3B0aW9uYWwpXG4gKiBAcHJvcGVydHkgdGV4dCAob3B0aW9uYWwpXG4gKiBAcHJvcGVydHkgbWV0YWRhdGEgKG9wdGlvbmFsKVxuICogQHByb3BlcnR5IGFjdGlvbiAob3B0aW9uYWwpXG4gKiBAcHJvcGVydHkgY2xhc3NlcyAob3B0aW9uYWwpXG4gKiBAcHJvcGVydHkgX21ldGEgKG9wdGlvbmFsKVxuICovXG5leHBvcnQgaW50ZXJmYWNlIENhcm91c2VsRm9yZWdyb3VuZEl0ZW0ge1xuICAvKipcbiAgICogSGVhZGVyXG4gICAqL1xuICB0aXRsZT86IHN0cmluZztcbiAgLyoqXG4gICAqIFRleHQgcGFyYWdyYXBoIC8gc3VidGl0bGUgLyBwcmV0aXRsZVxuICAgKi9cbiAgdGV4dD86IHN0cmluZztcbiAgLyoqXG4gICAqIE1ldGFkYXRhXG4gICAqL1xuICBtZXRhZGF0YT86IENhcm91c2VsTWV0YWRhdGFbXTtcbn1cblxuLyoqXG4gKiBJbnRlcmZhY2UgZm9yIENhcm91c2VsQ29tcG9uZW50J3MgXCJkYXRhXCJcbiAqXG4gKiBAcHJvcGVydHkgaXRlbXMgKHJlcXVpcmVkKVxuICogQHByb3BlcnR5IGltYWdlIChvcHRpb25hbClcbiAqIEBwcm9wZXJ0eSB2aWRlbyAob3B0aW9uYWwpXG4gKiBAcHJvcGVydHkgY2xhc3NlcyAob3B0aW9uYWwpXG4gKiBAcHJvcGVydHkgX21ldGEgKG9wdGlvbmFsKVxuICovXG5leHBvcnQgaW50ZXJmYWNlIENhcm91c2VsRGF0YSB7XG4gIC8qKlxuICAgKiBJRCBPZiB0aGUgY2Fyb3VzZWwgY29udGFpbmVyXG4gICAqL1xuICBjb250YWluZXJJZDogc3RyaW5nO1xuICAvKipcbiAgICogT3B0aW9ucyBmb3IgdGhlIGNhcm91c2VsIGxpYnJhcnkgKCBkb2NzIGhlcmUgOiBodHRwczovL2xhdHRlY2Fyb3VzZWwuZGV2LyApXG4gICAqL1xuICBsaWJPcHRpb25zPzogYW55O1xuICAvKipcbiAgICogQXJyYXkgb2YgY2Fyb3VzZWwgc2xpZGVzXG4gICAqL1xuICBzbGlkZXM6IHtcbiAgICBpdGVtczogQ2Fyb3VzZWxGb3JlZ3JvdW5kSXRlbVtdO1xuICAgIC8qKlxuICAgICAqIEJ1dHRvblxuICAgICAqL1xuICAgIGFjdGlvbj86IENhcm91c2VsQnV0dG9uO1xuICAgIGJhY2tncm91bmQ/OiBDYXJvdXNlbEJhY2tncm91bmRJdGVtO1xuICAgIGNsYXNzZXM/OiBzdHJpbmc7XG4gIH1bXTtcbiAgLyoqXG4gICAqIENhbGxiYWNrIGZvciBnZXR0aW5nIHRoZSBjYXJvdXNlbCBpbnN0YW5jZVxuICAgKi9cbiAgc2V0SW5zdGFuY2U/OiBhbnk7XG4gIC8qKlxuICAgKiBDYWxsYmFjayB0byBhY2Nlc3MgdGhlIGNhcm91c2VsIEFQSVxuICAgKiAqL1xuICBzZXRDb21wb25lbnRBUEk/OiBhbnk7XG4gIC8qKlxuICAgKiBDbGFzc2VzIGZvciB0aGUgY2Fyb3VzZWwgY29tcG9uZW50XG4gICAqL1xuICBjbGFzc2VzPzogc3RyaW5nO1xuICAvKipcbiAgICogQWRkaXRpb25hbCBkYXRhIHVzZWZ1bCBmb3IgdGhlIGNvbXBvbmVudCdzIGxvZ2ljXG4gICAqL1xuICBfbWV0YT86IGFueTtcbn1cblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnbjctY2Fyb3VzZWwnLFxuICB0ZW1wbGF0ZVVybDogJy4vY2Fyb3VzZWwuaHRtbCdcbn0pXG5leHBvcnQgY2xhc3MgQ2Fyb3VzZWxDb21wb25lbnQgaW1wbGVtZW50cyBBZnRlckNvbnRlbnRDaGVja2VkIHtcbiAgQElucHV0KCkgZGF0YTogQ2Fyb3VzZWxEYXRhO1xuXG4gIEBJbnB1dCgpIGVtaXQ6IGFueTtcblxuICBwcml2YXRlIGxvYWRlZCA9IGZhbHNlO1xuXG4gIC8qKlxuICAgKiBBUEkgb2YgdGhlIGNhcm91c2VsIGNvbXBvbmVudFxuICAgKi9cbiAgYXBpID0ge1xuICAgIC8qKlxuICAgICAqIFVzZWQgdG8gbGF6eS1sb2FkIHZpZGVvIHJlc291cmNlcy5cbiAgICAgKiBDYWxsIGFwaS5sb2FkLnZpZGVvcyBvbiBET01Db250ZW50UmVhZHkgZXZlbnRcbiAgICAgKi9cbiAgICBsb2FkOiB7XG4gICAgICAvKiogQ2hhbmdlcyBhbGwgZGF0YS1zcmMgYXR0cmlidXRlcyB0byBzcmMgYW5kIGNhbGxzIDx2aWRlbz4ubG9hZCgpICovXG4gICAgICB2aWRlb3M6ICgpID0+IHtcbiAgICAgICAgY29uc3Qgc291cmNlcyA9IEFycmF5LmZyb20oIC8vIGdldHMgYWxsIDxzb3VyY2UubGF6eT4gdGFnc1xuICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHRoaXMuZGF0YS5jb250YWluZXJJZClcbiAgICAgICAgICAgIC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCdsYXp5JylcbiAgICAgICAgKTtcbiAgICAgICAgc291cmNlcy5mb3JFYWNoKChzb3VyY2U6IEhUTUxFbGVtZW50KSA9PiB7XG4gICAgICAgICAgY29uc3QgdXJsID0gc291cmNlLmdldEF0dHJpYnV0ZSgnZGF0YS1zcmMnKTsgLy8gZ2V0cyB0aGUgdmlkZW8gdXJsXG4gICAgICAgICAgc291cmNlLmNsYXNzTGlzdC5yZW1vdmUoJ2xhenknKTsgLy8gcmVtb3ZlcyB0aGUgbGF6eSBjbGFzc1xuICAgICAgICAgIHNvdXJjZS5zZXRBdHRyaWJ1dGUoJ3NyYycsIHVybCk7IC8vIHNldHMgdGhlIHVybCB0byBzcmMgYXR0cmlidXRlXG4gICAgICAgICAgc291cmNlLnJlbW92ZUF0dHJpYnV0ZSgnZGF0YS1zcmMnKTsgLy8gcmVtb3ZlcyB0aGUgZGF0YS1zcmMgYXR0cmlidXRlXG4gICAgICAgICAgKHNvdXJjZS5wYXJlbnRFbGVtZW50IGFzIEhUTUxWaWRlb0VsZW1lbnQpLmxvYWQoKTsgLy8gbG9hZHMgdGhlIHZpZGVvXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH1cbiAgfTtcblxuICBuZ0FmdGVyQ29udGVudENoZWNrZWQoKTogdm9pZCB7XG4gICAgaWYgKCF0aGlzLmRhdGEgfHwgdGhpcy5sb2FkZWQpIHJldHVybjtcbiAgICB0aGlzLmxvYWRlZCA9IHRydWU7XG4gICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICBjb25zdCB7IGNvbnRhaW5lcklkLCBsaWJPcHRpb25zIH0gPSB0aGlzLmRhdGE7XG4gICAgICBpbXBvcnQoJ2xhdHRlLWNhcm91c2VsJykudGhlbigobW9kdWxlKSA9PiB7XG4gICAgICAgIGNvbnN0IHsgQ2Fyb3VzZWwgfSA9IG1vZHVsZTtcbiAgICAgICAgY29uc3QgY2hhcnQgPSBuZXcgQ2Fyb3VzZWwoYCMke2NvbnRhaW5lcklkfWAsIGxpYk9wdGlvbnMpO1xuICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tcGFyYW0tcmVhc3NpZ24sIEB0eXBlc2NyaXB0LWVzbGludC9uby11bnVzZWQtdmFyc1xuICAgICAgICBpZiAodGhpcy5kYXRhLnNldEluc3RhbmNlKSB0aGlzLmRhdGEuc2V0SW5zdGFuY2UoKGQpOiB2b2lkID0+IHsgZCA9IGNoYXJ0OyB9KTtcbiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXBhcmFtLXJlYXNzaWduLCBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tdW51c2VkLXZhcnNcbiAgICAgICAgaWYgKHRoaXMuZGF0YS5zZXRDb21wb25lbnRBUEkpIHRoaXMuZGF0YS5zZXRDb21wb25lbnRBUEkoKGQpOiB2b2lkID0+IHsgZCA9IHRoaXMuYXBpOyB9KTtcbiAgICAgICAgdGhpcy5hZGRCdXR0b25FdmVudHModGhpcy5kYXRhKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9XG5cbiAgb25DbGljayhwYXlsb2FkKSB7XG4gICAgaWYgKCF0aGlzLmVtaXQpIHJldHVybjtcbiAgICB0aGlzLmVtaXQoJ2NsaWNrJywgcGF5bG9hZCk7XG4gIH1cblxuICAvKipcbiAgICogRnVuY3Rpb24gdGhhdCBhZGRzIHRoZSBldmVudCBsaXN0ZW5lcnMgdG8gZWFjaCBidXR0b24uXG4gICAqIFRoaXMgaXMgbmVlZGVkIGJlY2F1c2Ugd2hlbiBcIm5ldyBDYXJvdXNlbCgpXCIgaXMgY2FsbGVkIHRoZSBldmVudCBsaXN0ZW5lcnMgYXJlIGxvc3QuXG4gICAqL1xuICBhZGRCdXR0b25FdmVudHMoeyBzbGlkZXMsIGNvbnRhaW5lcklkIH0pIHtcbiAgICAvLyBCdWlsZCBhcnJheSBvZiBidXR0b24taWQncyAmIHBheWxvYWRzLlxuICAgIGNvbnN0IGJ1dHRvbnM6IHsgaWQ6IHN0cmluZzsgcGF5bG9hZDogYW55IH1bXSA9IHNsaWRlc1xuICAgICAgLm1hcCgoc2xpZGUsIHNsaWRlSUQpID0+ICh7XG4gICAgICAgIC8vIGlkID0gY29udGFpbmVyIGlkIC0gaW5kZXggb2YgdGhlIHNsaWRlXG4gICAgICAgIGlkOiBgJHtjb250YWluZXJJZH0tJHtzbGlkZUlEfWAsXG4gICAgICAgIHBheWxvYWQ6ICgoKHNsaWRlLmFjdGlvbiB8fCB7fSkuYW5jaG9yIHx8IHt9KS5wYXlsb2FkKSB8fCB1bmRlZmluZWRcbiAgICAgIH0pKVxuICAgICAgLmZpbHRlcigoYnRuKSA9PiBidG4ucGF5bG9hZCk7XG4gICAgLy8gZmluZCBlYWNoIGJ1dHRvbidzIGFuY2hvci13cmFwcGVyIGFuZCBhdHRhY2ggdGhlIGV2ZW50IHRvIGl0LlxuICAgIGJ1dHRvbnMuZm9yRWFjaCgoYnRuKSA9PiB7XG4gICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGAjJHtidG4uaWR9YCkucGFyZW50RWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFxuICAgICAgICAnY2xpY2snLFxuICAgICAgICAoKSA9PiB0aGlzLm9uQ2xpY2soYnRuLnBheWxvYWQpXG4gICAgICApO1xuICAgIH0pO1xuICB9XG59XG4iXX0=